<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Survivor — Zombie Rush</title>
<style>
  :root{
    --bg:#0d1117;
    --panel:#0f1720;
    --accent:#ff5c33;
    --muted:#9aa6b2;
    --white:#eceff1;
  }
  html,body{height:100%;margin:0;}
  body{
    background: linear-gradient(180deg,#071021 0%,var(--bg) 100%);
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    color:var(--white);
    display:flex;
    align-items:center;
    justify-content:center;
  }

  #game-wrap{
    width:100%;
    max-width:1100px;
    height:80vh;
    max-height:800px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:12px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.6);
    position:relative;
    overflow:hidden;
  }

  canvas{
    display:block;
    width:100%;
    height:100%;
    background: linear-gradient(180deg,#031020, #061226);
  }

  .hud{
    position:absolute;
    left:16px;
    top:12px;
    display:flex;
    gap:12px;
    align-items:center;
    z-index:10;
  }
  .score{
    background: rgba(255,255,255,0.03);
    padding:8px 12px;
    border-radius:8px;
    font-weight:600;
    color:var(--white);
    min-width:120px;
    text-align:center;
  }
  .health-bar{
    width:220px;
    height:14px;
    background: rgba(255,255,255,0.06);
    border-radius:8px;
    overflow:hidden;
  }
  .health-fill{
    height:100%;
    width:100%;
    background: linear-gradient(90deg,#ff5c33,#ff9a66);
    transition:width .2s linear;
  }

  .help{
    position:absolute;
    right:12px;
    bottom:12px;
    background: rgba(255,255,255,0.03);
    padding:10px 12px;
    border-radius:8px;
    color:var(--muted);
    font-size:13px;
    z-index:10;
    max-width:220px;
  }

  .overlay{
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:20;
    background: linear-gradient(180deg, rgba(1,5,10,0.55), rgba(1,5,10,0.6));
  }
  .menu{
    width:90%;
    max-width:520px;
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border:1px solid rgba(255,255,255,0.03);
    padding:22px;
    border-radius:10px;
    text-align:center;
  }
  .menu h1{margin:0 0 6px;font-size:22px;}
  .menu p{color:var(--muted);margin:0 0 16px;font-size:14px;}
  .menu input[type="text"]{
    width:100%;
    padding:10px 12px;
    border-radius:8px;
    border:1px solid rgba(255,255,255,0.06);
    background:rgba(255,255,255,0.02);
    color:var(--white);
    margin-bottom:12px;
    font-size:15px;
  }
  .btn{
    background:var(--accent);
    color:white;
    border:none;
    padding:10px 16px;
    border-radius:8px;
    font-weight:700;
    cursor:pointer;
    box-shadow:0 6px 18px rgba(255,92,51,0.14);
  }
  .btn.secondary{
    background:transparent;
    border:1px solid rgba(255,255,255,0.06);
    color:var(--white);
    font-weight:600;
    margin-left:8px;
  }

  .leaderboard{
    margin-top:12px;
    text-align:left;
    max-height:180px;
    overflow:auto;
  }
  .leaderboard ol{
    padding-left:18px;
    margin:6px 0 0 0;
    color:var(--muted);
  }
  .leaderboard li{
    padding:6px 0;
    font-size:14px;
  }

  .gameover-box{
    width:90%;
    max-width:520px;
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border:1px solid rgba(255,255,255,0.03);
    padding:22px;
    border-radius:10px;
    text-align:center;
  }
  .muted{color:var(--muted);font-size:14px;}
  @media (max-width:640px){
    .help{display:none;}
  }
</style>
</head>
<body>

<div id="game-wrap">
  <canvas id="gameCanvas" width="1200" height="800"></canvas>

  <div class="hud">
    <div class="score" id="scoreBox">Score: 0</div>
    <div class="health-bar"><div class="health-fill" id="healthFill" style="width:100%"></div></div>
  </div>

  <div class="help">
    Controls:<br>
    WASD = Move • Mouse = Aim • Left click = Swing bat<br>
    Kill zombies for points. Upgrades later.
  </div>

  <div class="overlay" id="menuOverlay">
    <div class="menu">
      <h1>Zombie Rush</h1>
      <p>Enter your name and press Start. Kill zombies to earn points!</p>
      <input id="playerName" type="text" placeholder="Your name" maxlength="20" />
      <div style="display:flex; justify-content:center; gap:10px;">
        <button class="btn" id="startBtn">Start Game</button>
        <button class="btn secondary" id="openLB">View Leaderboard</button>
      </div>
      <div class="leaderboard" id="menuLeaderboard" style="display:none;">
        <h3>Top Scores</h3>
        <ol id="menuLBList"></ol>
      </div>
    </div>
  </div>

  <div class="overlay" id="gameOverOverlay" style="display:none;">
    <div class="gameover-box">
      <h2 id="finalTitle">You died</h2>
      <p class="muted" id="finalScore">Score: 0</p>
      <div style="margin-top:10px;">
        <button class="btn" id="retryBtn">Play Again</button>
        <button class="btn secondary" id="backMenu">Back to Menu</button>
      </div>
      <div style="margin-top:14px;text-align:left;">
        <h3>Leaderboard</h3>
        <ol id="gameOverLB"></ol>
      </div>
    </div>
  </div>

</div>

<script>
const CONFIG = {
  width: 1200, height: 800,
  player: { radius: 14, speed: 180, maxHealth: 100, attackCooldown: 400, attackRange: 40, attackAngleDeg: 90, attackDamage: 40 },
  zombie: { baseHP: 25, baseSpeed: 50, spawnPerWave: 6, waveDelay: 2800 },
  spawnMargin: 80,
  pointsPerKill: 10
};

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = CONFIG.width; canvas.height = CONFIG.height;

function resizeCanvasToFit(){
  const rect = document.getElementById('game-wrap').getBoundingClientRect();
  canvas.style.width = rect.width + 'px';
  canvas.style.height = rect.height + 'px';
}
window.addEventListener('resize', resizeCanvasToFit);
resizeCanvasToFit();

const input = { up:false, down:false, left:false, right:false, mouseX:0, mouseY:0, mouseDown:false };
window.addEventListener('keydown', e=>{ if(e.key==='w')input.up=true; if(e.key==='s')input.down=true; if(e.key==='a')input.left=true; if(e.key==='d')input.right=true; });
window.addEventListener('keyup', e=>{ if(e.key==='w')input.up=false; if(e.key==='s')input.down=false; if(e.key==='a')input.left=false; if(e.key==='d')input.right=false; });
canvas.addEventListener('mousemove', e=>{
  const r = canvas.getBoundingClientRect();
  const scaleX = canvas.width / r.width, scaleY = canvas.height / r.height;
  input.mouseX = (e.clientX - r.left) * scaleX;
  input.mouseY = (e.clientY - r.top) * scaleY;
});
canvas.addEventListener('mousedown', ()=> input.mouseDown = true);
window.addEventListener('mouseup', ()=> input.mouseDown = false);

let player = {x:CONFIG.width/2,y:CONFIG.height/2,vx:0,vy:0,hp:CONFIG.player.maxHealth,name:'Player',score:0,lastAttack:0};
let zombies=[],alive=false,lastFrameTime=performance.now(),wave=0,waveInProgress=false;
const healthFill=document.getElementById('healthFill'),scoreBox=document.getElementById('scoreBox'),menuOverlay=document.getElementById('menuOverlay'),gameOverOverlay=document.getElementById('gameOverOverlay'),playerNameInput=document.getElementById('playerName'),menuLB=document.getElementById('menuLBList');
const LB_KEY='survivor_leaderboard_v1';
function rand(a,b){return Math.random()*(b-a)+a;}
function dist(ax,ay,bx,by){const dx=ax-bx,dy=ay-by;return Math.hypot(dx,dy);}
function clamp(v,a,b){return Math.max(a,Math.min(b,v));}

function spawnZombie(hpM=1,spdM=1){
  let side=Math.floor(rand(0,4)),x,y,m=CONFIG.spawnMargin;
  if(side===0){x=rand(0,CONFIG.width);y=-m;}
  else if(side===1){x=CONFIG.width+m;y=rand(0,CONFIG.height);}
  else if(side===2){x=rand(0,CONFIG.width);y=CONFIG.height+m;}
  else{x=-m;y=rand(0,CONFIG.height);}
  zombies.push({x,y,r:rand(10,16),hp:CONFIG.zombie.baseHP*hpM,maxHp:CONFIG.zombie.baseHP*hpM,speed:CONFIG.zombie.baseSpeed*spdM,angle:0});
}
function startWave(){
  wave++;waveInProgress=true;
  const base=CONFIG.zombie.spawnPerWave+Math.floor(wave*1.2),hpMul=1+(wave-1)*0.12,spdMul=1+(wave-1)*0.03;
  for(let i=0;i<base;i++)setTimeout(()=>spawnZombie(hpMul,spdMul),i*200+rand(0,700));
}
function update(dt){
  if(!alive)return;
  let mvx=0,mvy=0;if(input.up)mvy--;if(input.down)mvy++;if(input.left)mvx--;if(input.right)mvx++;
  const len=Math.hypot(mvx,mvy)||1;player.vx=(mvx/len)*CONFIG.player.speed;player.vy=(mvy/len)*CONFIG.player.speed;
  player.x=clamp(player.x+player.vx*dt,10,CONFIG.width-10);player.y=clamp(player.y+player.vy*dt,10,CONFIG.height-10);
  const now=performance.now();if(input.mouseDown&&now-player.lastAttack>CONFIG.player.attackCooldown){player.lastAttack=now;doAttack();}
  for(let i=zombies.length-1;i>=0;i--){const z=zombies[i];const dx=player.x-z.x,dy=player.y-z.y,d=Math.hypot(dx,dy)||1;z.x+=(dx/d)*z.speed*dt;z.y+=(dy/d)*z.speed*dt;z.angle=Math.atan2(dy,dx);
    if(dist(z.x,z.y,player.x,player.y)<z.r+CONFIG.player.radius){player.hp-=8*dt*30;if(player.hp<=0){player.hp=0;endGame();}}
    if(z.hp<=0){player.score+=CONFIG.pointsPerKill;zombies.splice(i,1);}
  }
  if(waveInProgress&&zombies.length===0){waveInProgress=false;setTimeout(()=>startWave(),CONFIG.zombie.waveDelay);}
  scoreBox.textContent=`Score: ${Math.floor(player.score)}`;healthFill.style.width=`${(player.hp/CONFIG.player.maxHealth)*100}%`;
}
function doAttack(){
  const ax=player.x,ay=player.y,mx=input.mouseX,my=input.mouseY,ang=Math.atan2(my-ay,mx-ax);
  const half=(CONFIG.player.attackAngleDeg*Math.PI/180)/2,dmg=CONFIG.player.attackDamage;attackEffects.push({x:ax,y:ay,angle:ang,t:0});
  for(let z of zombies){const dx=z.x-ax,dy=z.y-ay,d=Math.hypot(dx,dy);if(d<=CONFIG.player.attackRange+z.r){let diff=Math.atan2(Math.sin(Math.atan2(dy,dx)-ang),Math.cos(Math.atan2(dy,dx)-ang));if(Math.abs(diff)<=half)z.hp-=dmg;}}
}
let attackEffects=[];
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle='#0b1620';ctx.globalAlpha=0.06;ctx.fillRect(0,0,canvas.width,canvas.height);ctx.globalAlpha=1;
  for(let z of zombies){
    ctx.save();ctx.translate(z.x,z.y);
    ctx.fillStyle='rgba(0,0,0,0.25)';ctx.beginPath();ctx.ellipse(0,z.r+6,z.r+6,z.r/2,0,0,Math.PI*2);ctx.fill();
    const hpFrac=z.hp/z.maxHp;ctx.fillStyle=`rgba(${Math.floor(200+55*(1-hpFrac))},${Math.floor(60+80*hpFrac)},60,1)`;ctx.beginPath();ctx.arc(0,0,z.r,0,Math.PI*2);ctx.fill();
    ctx.fillStyle='#111';ctx.beginPath();ctx.arc(-z.r*0.26,-z.r*0.2,z.r*0.18,0,Math.PI*2);ctx.fill();ctx.beginPath();ctx.arc(z.r*0.26,-z.r*0.2,z.r*0.18,0,Math.PI*2);ctx.fill();
    ctx.restore();
  }
  ctx.fillStyle='rgba(0,0,0,0.3)';ctx.beginPath();ctx.ellipse(player.x,player.y+12,CONFIG.player.radius+8,CONFIG.player.radius/2+6,0,0,Math.PI*2);ctx.fill();
  ctx.fillStyle='#2ee6a7';ctx.beginPath();ctx.arc(player.x,player.y,CONFIG.player.radius,0,Math.PI*2);ctx.fill();
  const ang=Math.atan2(input.mouseY-player.y,input.mouseX-player.x);
  ctx.save();ctx.translate(player.x,player.y);ctx.rotate(ang);ctx.fillStyle='#083f33';
  ctx.beginPath();ctx.moveTo(CONFIG.player.radius+2,0);ctx.lineTo(CONFIG.player.radius-4,-6);ctx.lineTo(CONFIG.player.radius-4,6);ctx.closePath();ctx.fill();ctx.restore();
  for(let i=attackEffects.length-1;i>=0;i--){const e=attackEffects[i];e.t+=1/60;const a=Math.max(0,1-e.t*1.7);if(a<=0){attackEffects.splice(i,1);continue;}
    ctx.save();ctx.globalAlpha=a;ctx.translate(e.x,e.y);ctx.rotate(e.angle);ctx.fillStyle='rgba(255,140,60,0.9)';
    const spread=CONFIG.player.attackAngleDeg*Math.PI/180;ctx.beginPath();ctx.moveTo(0,0);ctx.arc(0,0,CONFIG.player.attackRange+10,-spread/2,spread/2);ctx.closePath();ctx.fill();ctx.restore();}
  ctx.fillStyle='rgba(255,255,255,0.06)';ctx.fillRect(10,canvas.height-40,220,30);ctx.fillStyle='#fff';ctx.font='14px Inter, Arial';ctx.fillText(`Wave ${wave} • Zombies: ${zombies.length}`,20,canvas.height-20);
  ctx.strokeStyle='rgba(255,255,255,0.6)';ctx.beginPath();ctx.arc(input.mouseX,input.mouseY,6,0,Math.PI*2);ctx.stroke();
}
function loop(t){const dt=(t-lastFrameTime)/1000;lastFrameTime=t;update(dt);draw();requestAnimationFrame(loop);}
function startGame(){player.x=CONFIG.width/2;player.y=CONFIG.height/2;player.hp=CONFIG.player.maxHealth;player.score=0;player.name=(playerNameInput.value.trim()||'Player').slice(0,20);zombies=[];wave=0;waveInProgress=false;alive=true;menuOverlay.style.display='none';gameOverOverlay.style.display='none';setTimeout(()=>startWave(),400);}
function endGame(){if(!alive)return;alive=false;saveScore(player.name,Math.floor(player.score));document.getElementById('finalScore').textContent=`Score: ${Math.floor(player.score)}`;populateGameOverLB();gameOverOverlay.style.display='flex';}
function loadLeaderboard(){try{return JSON.parse(localStorage.getItem(LB_KEY)||'[]');}catch{return[];}}
function saveScore(name,score){let lb=loadLeaderboard();lb.push({name,score});lb.sort((a,b)=>b.score-a.score);lb=lb.slice(0,10);localStorage.setItem(LB_KEY,JSON.stringify(lb));}
function populateMenuLB(){const lb=loadLeaderboard();menuLB.innerHTML=lb.map(e=>`<li>${e.name} — ${e.score}</li>`).join('')||'<li>No scores yet</li>';}
function populateGameOverLB(){const lb=loadLeaderboard(),list=document.getElementById('gameOverLB');list.innerHTML=lb.map(e=>`<li>${e.name} — ${e.score}</li>`).join('');}

document.getElementById('startBtn').onclick=startGame;
document.getElementById('retryBtn').onclick=startGame;
document.getElementById('backMenu').onclick=()=>{gameOverOverlay.style.display='none';menuOverlay.style.display='flex';};
document.getElementById('openLB').onclick=()=>{const lbBox=document.getElementById('menuLeaderboard');lbBox.style.display=lbBox.style.display==='none'?'block':'none';populateMenuLB();};

requestAnimationFrame(loop);
</script>

</body>
</html>
